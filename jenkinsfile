node {
  stage('Clone') {
    checkout scm
  }

  stage('Build image') {
    sh 'docker build -t xavki/nginx .'
  }

  stage('Run image') {
  sh '''
    CID=$(docker run -d --rm -p 8081:80 xavki/nginx)
    sleep 5
    curl -s http://localhost:8081 | head
    docker stop "$CID"
  '''
}

}

