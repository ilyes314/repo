node {
  stage('Clone') {
    checkout scm
  }

  stage('Build image') {
    sh 'docker build -t xavki/nginx .'
  }

  stage('Run image') {
    sh '''
      docker run -d --rm -p 8081:80 --name test-nginx xavki/nginx
      sleep 5
      curl -s http://localhost:8081 | head
      docker stop test-nginx
    '''
  }
}

